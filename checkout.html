<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Checkout</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="index.css" />
    <link rel="stylesheet" href="checkout.css" />
  </head>

  <body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <div class="container-fluid">
        <a class="navbar-brand" href="index.html">Cnowledge</a>

        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
          aria-controls="navbarNav"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav mx-auto">
            <li class="nav-item">
              <a class="nav-link" href="courses.html">Courses</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="signup.html">Sign up</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="about.html">About</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="contact.html">Contact</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="checkout.html">Checkout</a>
            </li>
          </ul>

          <div class="nav-icons">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
              class="nav-icon"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z"
              />
            </svg>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
              class="nav-icon"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"
              />
            </svg>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
              class="nav-icon"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M10.343 3.94c.09-.542.56-.94 1.11-.94h1.093c.55 0 1.02.398 1.11.94l.149.894c.07.424.384.764.78.93.398.164.855.142 1.205-.108l.737-.527a1.125 1.125 0 0 1 1.45.12l.773.774c.39.389.44 1.002.12 1.45l-.527.737c-.25.35-.272.806-.107 1.204.165.397.505.71.93.78l.893.15c.543.09.94.559.94 1.109v1.094c0 .55-.397 1.02-.94 1.11l-.894.149c-.424.07-.764.383-.929.78-.165.398-.143.854.107 1.204l.527.738c.32.447.269 1.06-.12 1.45l-.774.773a1.125 1.125 0 0 1-1.449.12l-.738-.527c-.35-.25-.806-.272-1.203-.107-.398.165-.71.505-.781.929l-.149.894c-.09.542-.56.94-1.11.94h-1.094c-.55 0-1.019-.398-1.11-.94l-.148-.894c-.071-.424-.384-.764-.781-.93-.398-.164-.854-.142-1.204.108l-.738.527c-.447.32-1.06.269-1.45-.12l-.773-.774a1.125 1.125 0 0 1-.12-1.45l.527-.737c.25-.35.272-.806.108-1.204-.165-.397-.506-.71-.93-.78l-.894-.15c-.542-.09-.94-.56-.94-1.109v-1.094c0-.55.398-1.02.94-1.11l.894-.149c.424-.07.765-.383.93-.78.165-.398.143-.854-.108-1.204l-.526-.738a1.125 1.125 0 0 1 .12-1.45l.773-.773a1.125 1.125 0 0 1 1.45-.12l.737.527c.35.25.807.272 1.204.107.397-.165.71-.505.78-.929l.15-.894Z"
              />
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"
              />
            </svg>
          </div>
        </div>
      </div>
    </nav>

    <h1 class="page-title">Checkout</h1>
    <div class="checkout-dropdown dropdown">
      <button
        class="dropdown-toggle"
        type="button"
        data-bs-toggle="dropdown"
        aria-expanded="false"
      >
        Select Course
      </button>
      <ul id="selectCourse" class="dropdown-menu checkout-menu"></ul>
    </div>

    <p
      id="selectedCourseTitle"
      style="
        text-align: center;
        color: #333;
        font-weight: bold;
        font-size: 1.4rem;
      "
    ></p>

    <form class="checkout-form" id="checkoutForm">
      <div class="mb-3">
        <label for="coursePrice" class="form-label checkout-label"
          >Course Price</label
        >
        <input
          type="number"
          class="form-control checkout-input"
          min="10"
          id="coursePrice"
          aria-describedby="coursePrice"
        />
        <div id="error" class="form-text">
          <span class="checkout-error-price"> </span>
        </div>
      </div>

      <div style="display: flex; gap: 1rem; flex-wrap: wrap">
        <label class="checkout-radio">I don't have discount code</label>
        <input
          onclick="showDiscountCode()"
          id="noDiscount"
          name="discount"
          type="radio"
        />
        <label class="checkout-radio">I have discount code</label>
        <input
          onclick="showDiscountCode()"
          id="haveDiscount"
          name="discount"
          type="radio"
        />
      </div>

      <div class="mb-3">
        <label for="discountCode" class="form-label checkout-label"
          >Discount code</label
        >
        <input
          type="text"
          class="form-control checkout-input"
          id="discountCode"
        />

        <div id="error" class="form-text">
          <span class="checkout-error-discount"> </span>
        </div>
      </div>

      <button
        class="checkout-button btn btn-primary"
        type="submit"
        id="addCourseBtn"
      >
        Add Course
      </button>
    </form>

    <!-- Course Card Section -->
    <div class="container">
      <div id="courseCardSection" class="row"></div>
    </div>

    <!-- Modal for alert when user want to delete a course -->
    <div
      class="modal fade"
      id="confirmDeleteModal"
      tabindex="-1"
      aria-labelledby="confirmDeleteModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="confirmDeleteModalLabel">
              Confirm Deletion
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            Are you sure you want to remove this course?
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cancel
            </button>
            <button
              id="confirmDeleteButton"
              type="button"
              class="btn btn-danger"
            >
              Delete
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="checkbox-center">
      <input type="checkbox" class="form-check-input" id="buyMeACoffee" />
      <label class="form-check-label" for="buyMeACoffee"
        >Buy me a coffee ($5)</label
      >
    </div>

    <!-- Section to calculate total price -->
    <div class="mt-4 textarea-container">
      <button id="calculateTotalBtn" class="calculateTotalBtn">
        Calculate Total
      </button>
      <textarea
        id="totalPriceDisplay"
        class="form-control mt-2 totalPriceDisplay"
        rows="1"
        readonly
        placeholder="Total price will be displayed here"
      ></textarea>
    </div>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>

    <script>
      document.getElementById("noDiscount").checked = true;
      document.getElementById("haveDiscount").checked = false;
      document.getElementById("discountCode").setAttribute("readonly", true);
      document.getElementById("discountCode").style = "cursor: not-allowed";

      function showDiscountCode() {
        const noDiscount = document.getElementById("noDiscount").checked;
        const haveDiscount = document.getElementById("haveDiscount").checked;
        const discountCode = document.getElementById("discountCode");

        if (noDiscount) {
          discountCode.setAttribute("readonly", true);
          discountCode.style = "cursor: not-allowed";

          discountCode.value = "";
        } else if (haveDiscount) {
          discountCode.removeAttribute("readonly");
          discountCode.style = "cursor: text";
          discountCode.value = "";
        }
      }
      const coursesNames = [
        {
          title: "The Complete 2024 Web Development Bootcamp",
          content: "Dr. Angela Yu, Developer and Lead...",
          thumbnailUrl:
            "https://img-c.udemycdn.com/course/240x135/1565838_e54e_18.jpg",
          id: 1,
        },
        {
          title: "The Web Developer Bootcamp 2024",
          content: "Colt Steele",
          thumbnailUrl:
            "https://img-c.udemycdn.com/course/750x422/625204_436a_3.jpg",
          id: 2,
        },
        {
          title: "Web Development Masterclass - Online Certification Course",
          content: "YouAccel Training",
          thumbnailUrl:
            "https://img-c.udemycdn.com/course/240x135/965528_737d_7.jpg",
          id: 3,
        },
        {
          title: "Practical Web Development: 22 Courses in 1",
          content: "Creative Online School.",
          thumbnailUrl:
            "https://img-c.udemycdn.com/course/240x135/1415652_ad99_4.jpg",
          id: 4,
        },
        {
          title: "Internet and Web Development Fundamentals",
          content: "YouAccel Training",
          thumbnailUrl:
            "https://img-c.udemycdn.com/course/240x135/2334226_3436_3.jpg",
          id: 5,
        },
        {
          title: "Pre-Programming: Everything you need to know before you...",
          content: "Evan Kimbrell",
          thumbnailUrl:
            "https://img-c.udemycdn.com/course/750x422/881980_fc8f.jpg",
          id: 6,
        },
        {
          title: "CSS, Bootstrap ,JavaScript, Web Development Course",
          content: "PROPER DOT INSTITUTE",
          thumbnailUrl:
            "https://img-c.udemycdn.com/course/240x135/4548492_0942.jpg",
          id: 7,
        },
        {
          title: "The Complete 2020 Fullstack Web Developer Course",
          content: "Kalob Taulien",
          thumbnailUrl:
            "https://img-c.udemycdn.com/course/750x422/19332_6b49_15.jpg",
          id: 8,
        },
      ];

      const selectCourse = document.getElementById("selectCourse");
      const addCourseBtn = document.getElementById("addCourseBtn");

      // Add the courses in the coursesNames array to the dropdown menu as options
      coursesNames.forEach((course) => {
        const optionElement = document.createElement("li");
        optionElement.classList.add("dropdown-item");
        const textNode = document.createTextNode(course.title);
        optionElement.appendChild(textNode);
        optionElement.id = course.id;
        selectCourse.appendChild(optionElement);
      });

      let selectedCourse = "";
      const courseItems = document.querySelectorAll(
        "#selectCourse .dropdown-item"
      );

      courseItems.forEach((item) => {
        item.addEventListener("click", (event) => {
          selectedCourse = event.target.textContent;
          document.querySelector("#selectedCourseTitle").textContent =
            selectedCourse;
        });
      });

      addCourseBtn.addEventListener("click", function (event) {
        event.preventDefault();

        const coursePrice = document.getElementById("coursePrice").value;
        const discountCode = document.getElementById("discountCode").value;
        const errorPrice = document.querySelector(".checkout-error-price");
        const errorDiscount = document.querySelector(
          ".checkout-error-discount"
        );

        // Validation
        if (!selectedCourse) {
          errorPrice.textContent = "Please select a course!";
          return;
        }
        if (coursePrice < 10 || isNaN(coursePrice) || coursePrice === "") {
          errorPrice.textContent =
            "Please enter a positive number for the price!";
          return;
        }
        errorPrice.textContent = "";
        errorDiscount.textContent = "";

        // Check for discount
        let finalPrice = parseFloat(coursePrice);
        if (discountCode === "CNOWLEDGE2025") {
          finalPrice = finalPrice - finalPrice * 0.2; // 20% discount
        } else if (discountCode !== "CNOWLEDGE2025" && haveDiscount.checked) {
          errorDiscount.textContent = "Invalid discount code";
          return;
        }

        // Display Bootstrap-styled course card
        const courseCardSection = document.getElementById("courseCardSection");

        const courseCard = document.createElement("div");
        courseCard.classList.add("col-lg-4", "col-md-6", "col-sm-12", "mb-4");

        courseCard.innerHTML = `
              <div class="card mx-auto" style="width: 100%; height: auto;">
                <img src="${
                  coursesNames.find((course) => course.title === selectedCourse)
                    .thumbnailUrl
                }" class="card-img-top" alt="${selectedCourse}">
                <div class="card-body d-flex flex-column">
                  <h5 class="card-title">${selectedCourse}</h5>
                  <p class="card-text" style="font-weight: bold; font-size: 1.3rem; color: #4263eb; ">Price: $${finalPrice.toFixed(
                    2
                  )}</p>
                  <p class="card-text">${
                    coursesNames.find(
                      (course) => course.title === selectedCourse
                    ).content
                  }</p>
                  <div class="mt-auto d-flex justify-content-between">
                    <a href="course${
                      coursesNames.find(
                        (course) => course.title === selectedCourse
                      ).id
                    }.html" class="btn btn-primary">Show More</a>
                    <button class="btn btn-danger" onclick="confirmDelete(this)">Delete</button>
                  </div>
                </div>
              </div>
            `;

        courseCardSection.appendChild(courseCard);
      });

      // Function to show confirmation modal
      function confirmDelete(button) {
        const modal = new bootstrap.Modal(
          document.getElementById("confirmDeleteModal")
        );
        const deleteButton = document.getElementById("confirmDeleteButton");

        deleteButton.onclick = () => {
          const card = button.closest(".col-lg-4, .col-md-6, .col-sm-12");
          card.remove();
          modal.hide();
        };

        modal.show();
      }

      document
        .getElementById("calculateTotalBtn")
        .addEventListener("click", () => {
          const courseCards = document.querySelectorAll(
            "#courseCardSection .card"
          );
          let totalPrice = 0;

          // Calculate total price from the course cards
          courseCards.forEach((card) => {
            const priceText = card.querySelector(".card-text").textContent;

            const priceParts = priceText.split(" ");
            const price = parseFloat(
              priceParts[priceParts.length - 1].replace("$", "")
            );

            if (!isNaN(price)) {
              totalPrice += price;
            }
          });

          // Check if the "Buy me a coffee" checkbox is checked and add $5 if true
          const buyMeACoffeeCheckbox = document.getElementById("buyMeACoffee");
          if (buyMeACoffeeCheckbox.checked) {
            totalPrice += 5; // Add $5 to the total price
          }

          // Display the total price
          const totalPriceDisplay =
            document.getElementById("totalPriceDisplay");
          totalPriceDisplay.value = `Total Price: $${totalPrice.toFixed(2)}`;
        });
    </script>
  </body>
</html>
